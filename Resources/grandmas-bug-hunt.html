<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é˜¿å¬¤çš„èœå¸‚å ´ | Bug çµå ´æŒ‘æˆ°</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Courier+Prime:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --grandma-red: #D94848;
            --grandma-orange: #F2994A;
            --grandma-yellow: #F2C94C;
            --grandma-green: #219653;
            --grandma-cream: #FFF8E7;
            --grandma-brown: #5D4037;
            --market-tile: #E8D5B7;
            --success-green: #27AE60;
            --warning-orange: #E67E22;
            --bug-found: #9B59B6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: var(--grandma-cream);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ===== éŠæˆ²é–‹å§‹ç•«é¢ ===== */
        .game-intro {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, var(--grandma-red) 0%, var(--grandma-orange) 100%);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            transition: opacity 0.5s, transform 0.5s;
        }

        .game-intro.hidden {
            opacity: 0;
            pointer-events: none;
            transform: scale(1.1);
        }

        .intro-grandma {
            font-size: 8rem;
            animation: bounce 1s ease-in-out infinite;
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.3));
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .intro-title {
            font-size: 3.5rem;
            font-weight: 900;
            color: white;
            text-shadow: 4px 4px 0 var(--grandma-brown), 
                         8px 8px 0 rgba(0,0,0,0.2);
            margin: 1rem 0;
            text-align: center;
        }

        .intro-subtitle {
            font-size: 1.5rem;
            color: var(--grandma-yellow);
            margin-bottom: 2rem;
            text-align: center;
        }

        .intro-rules {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 500px;
            margin-bottom: 2rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            border: 4px dashed var(--grandma-orange);
        }

        .intro-rules h3 {
            color: var(--grandma-red);
            font-size: 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .intro-rules ul {
            list-style: none;
            font-size: 1.1rem;
            color: var(--grandma-brown);
        }

        .intro-rules li {
            padding: 0.5rem 0;
            padding-left: 2rem;
            position: relative;
        }

        .intro-rules li::before {
            content: 'ğŸ›';
            position: absolute;
            left: 0;
        }

        .start-btn {
            background: var(--grandma-yellow);
            color: var(--grandma-brown);
            border: none;
            padding: 1.2rem 3rem;
            font-size: 1.5rem;
            font-weight: 900;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 6px 0 #C9A227, 0 10px 20px rgba(0,0,0,0.2);
            transition: all 0.2s;
            font-family: inherit;
        }

        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 9px 0 #C9A227, 0 15px 30px rgba(0,0,0,0.3);
        }

        .start-btn:active {
            transform: translateY(3px);
            box-shadow: 0 3px 0 #C9A227;
        }

        /* ===== éŠæˆ² HUD ===== */
        .game-hud {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, var(--grandma-red), var(--grandma-orange));
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .hud-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .hud-grandma {
            font-size: 2.5rem;
        }

        .hud-title {
            color: white;
            font-weight: 700;
        }

        .hud-title span {
            font-size: 0.8rem;
            display: block;
            opacity: 0.8;
        }

        .hud-stats {
            display: flex;
            gap: 2rem;
        }

        .stat-box {
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1.5rem;
            border-radius: 10px;
            text-align: center;
            color: white;
        }

        .stat-label {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 900;
            font-family: 'Courier Prime', monospace;
        }

        .timer-critical {
            animation: pulse-red 0.5s ease-in-out infinite;
        }

        @keyframes pulse-red {
            0%, 100% { background: rgba(255,0,0,0.5); }
            50% { background: rgba(255,0,0,0.8); }
        }

        /* ===== ç¶²ç«™ä¸»é«” ===== */
        .shop-container {
            margin-top: 80px;
            padding: 2rem;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .shop-header {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 3px solid var(--market-tile);
        }

        .shop-logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .shop-logo-icon {
            font-size: 3rem;
        }

        .shop-logo-text h1 {
            color: var(--grandma-green);
            font-size: 2rem;
        }

        .shop-logo-text p {
            color: #888;
            font-size: 0.9rem;
        }

        .shop-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .cart-btn {
            background: var(--grandma-green);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-family: inherit;
            font-weight: 700;
            transition: all 0.3s;
        }

        .cart-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(33, 150, 83, 0.4);
        }

        .cart-count {
            background: var(--grandma-red);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        .login-btn {
            background: transparent;
            border: 2px solid var(--grandma-orange);
            color: var(--grandma-orange);
            padding: 0.8rem 1.5rem;
            border-radius: 50px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 600;
            transition: all 0.3s;
        }

        .login-btn:hover {
            background: var(--grandma-orange);
            color: white;
        }

        /* ===== å•†å“å€åŸŸ ===== */
        .promo-banner {
            background: linear-gradient(135deg, var(--grandma-yellow), var(--grandma-orange));
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .promo-text h2 {
            color: white;
            font-size: 2rem;
            text-shadow: 2px 2px 0 rgba(0,0,0,0.1);
        }

        .promo-text p {
            color: rgba(255,255,255,0.9);
            margin-top: 0.5rem;
        }

        .promo-coupon {
            background: white;
            padding: 1rem 2rem;
            border-radius: 10px;
            text-align: center;
            border: 3px dashed var(--grandma-red);
        }

        .promo-coupon span {
            display: block;
            font-size: 0.8rem;
            color: #888;
        }

        .promo-coupon strong {
            font-size: 1.5rem;
            color: var(--grandma-red);
            font-family: 'Courier Prime', monospace;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
        }

        .product-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transition: all 0.3s;
            border: 3px solid transparent;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            border-color: var(--grandma-green);
        }

        .product-image {
            height: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 6rem;
            background: linear-gradient(135deg, #f8f8f8, #fff);
        }

        .product-info {
            padding: 1.5rem;
        }

        .product-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--grandma-brown);
            margin-bottom: 0.5rem;
        }

        .product-origin {
            font-size: 0.85rem;
            color: #888;
            margin-bottom: 1rem;
        }

        .product-price {
            display: flex;
            align-items: baseline;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .price-current {
            font-size: 1.8rem;
            font-weight: 900;
            color: var(--grandma-red);
        }

        .price-unit {
            font-size: 0.9rem;
            color: #888;
        }

        .price-original {
            font-size: 1rem;
            color: #aaa;
            text-decoration: line-through;
        }

        .product-qty {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .qty-btn {
            width: 36px;
            height: 36px;
            border: 2px solid var(--grandma-green);
            background: white;
            color: var(--grandma-green);
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .qty-btn:hover {
            background: var(--grandma-green);
            color: white;
        }

        .qty-input {
            width: 60px;
            text-align: center;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 0.5rem;
            font-size: 1rem;
            font-family: inherit;
        }

        .add-cart-btn {
            width: 100%;
            background: var(--grandma-green);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.3s;
        }

        .add-cart-btn:hover {
            background: #1a7a42;
        }

        /* ===== è³¼ç‰©è»Šé¢æ¿ ===== */
        .cart-panel {
            position: fixed;
            top: 0;
            right: -450px;
            width: 450px;
            height: 100vh;
            background: white;
            box-shadow: -5px 0 30px rgba(0,0,0,0.2);
            z-index: 200;
            transition: right 0.4s ease;
            display: flex;
            flex-direction: column;
        }

        .cart-panel.open {
            right: 0;
        }

        .cart-header {
            background: var(--grandma-green);
            color: white;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-header h2 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .close-cart {
            background: transparent;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .cart-items {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .cart-item {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            border-bottom: 1px solid #eee;
            align-items: center;
        }

        .cart-item-emoji {
            font-size: 2.5rem;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 700;
            color: var(--grandma-brown);
        }

        .cart-item-price {
            color: var(--grandma-red);
            font-weight: 600;
        }

        .cart-item-qty {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .cart-item-remove {
            background: transparent;
            border: none;
            color: #ccc;
            font-size: 1.2rem;
            cursor: pointer;
        }

        .cart-item-remove:hover {
            color: var(--grandma-red);
        }

        .cart-empty {
            text-align: center;
            padding: 3rem;
            color: #888;
        }

        .cart-empty span {
            font-size: 4rem;
            display: block;
            margin-bottom: 1rem;
        }

        .cart-footer {
            padding: 1.5rem;
            border-top: 2px solid #eee;
        }

        .coupon-input {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .coupon-input input {
            flex: 1;
            padding: 0.8rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: inherit;
        }

        .coupon-input button {
            background: var(--grandma-orange);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-family: inherit;
        }

        .cart-totals {
            margin-bottom: 1rem;
        }

        .cart-total-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
        }

        .cart-total-row.discount {
            color: var(--grandma-green);
        }

        .cart-total-row.final {
            font-size: 1.3rem;
            font-weight: 900;
            border-top: 2px solid var(--grandma-brown);
            padding-top: 1rem;
            margin-top: 0.5rem;
        }

        .checkout-btn {
            width: 100%;
            background: var(--grandma-red);
            color: white;
            border: none;
            padding: 1.2rem;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.3s;
        }

        .checkout-btn:hover {
            background: #c13838;
        }

        /* ===== ç™»å…¥å½ˆçª— ===== */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 300;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .modal-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }

        .modal {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            width: 90%;
            max-width: 400px;
            transform: scale(0.9);
            transition: transform 0.3s;
        }

        .modal-overlay.show .modal {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-header h2 {
            color: var(--grandma-brown);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .modal-close {
            background: transparent;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #888;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--grandma-brown);
        }

        .form-group input {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--grandma-green);
        }

        .login-submit {
            width: 100%;
            background: var(--grandma-green);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            font-family: inherit;
            margin-top: 1rem;
        }

        .login-hint {
            margin-top: 1rem;
            padding: 1rem;
            background: #f0f0f0;
            border-radius: 10px;
            font-size: 0.85rem;
            color: #666;
        }

        /* ===== Bug ç™¼ç¾æç¤º ===== */
        .bug-toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(150%);
            background: linear-gradient(135deg, var(--bug-found), #8E44AD);
            color: white;
            padding: 1.5rem 2rem;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(155, 89, 182, 0.4);
            z-index: 400;
            max-width: 500px;
            width: 90%;
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .bug-toast.show {
            transform: translateX(-50%) translateY(0);
        }

        .bug-toast-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }

        .bug-toast-icon {
            font-size: 2rem;
            animation: wiggle 0.5s ease-in-out infinite;
        }

        @keyframes wiggle {
            0%, 100% { transform: rotate(-10deg); }
            50% { transform: rotate(10deg); }
        }

        .bug-toast-title {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .bug-toast-chapter {
            background: rgba(255,255,255,0.2);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .bug-toast-message {
            font-size: 1rem;
            line-height: 1.5;
        }

        .bug-toast-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: transparent;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            opacity: 0.7;
        }

        .bug-toast-close:hover {
            opacity: 1;
        }

        /* ===== çµç®—ç•«é¢ ===== */
        .checkout-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            z-index: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .checkout-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }

        .checkout-result {
            background: white;
            border-radius: 30px;
            padding: 3rem;
            text-align: center;
            max-width: 500px;
            width: 90%;
        }

        .checkout-icon {
            font-size: 6rem;
            margin-bottom: 1rem;
        }

        .checkout-title {
            font-size: 2rem;
            color: var(--grandma-brown);
            margin-bottom: 1rem;
        }

        .checkout-amount {
            font-size: 3rem;
            font-weight: 900;
            color: var(--grandma-red);
            margin-bottom: 1rem;
        }

        .checkout-amount.negative {
            color: var(--grandma-green);
        }

        .checkout-message {
            color: #666;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .checkout-close {
            background: var(--grandma-green);
            color: white;
            border: none;
            padding: 1rem 3rem;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            font-family: inherit;
        }

        /* ===== éŠæˆ²çµæŸç•«é¢ ===== */
        .game-over {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, var(--grandma-red), var(--bug-found));
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
        }

        .game-over.show {
            opacity: 1;
            pointer-events: auto;
        }

        .game-over-icon {
            font-size: 8rem;
            margin-bottom: 1rem;
        }

        .game-over-title {
            font-size: 3rem;
            color: white;
            text-shadow: 4px 4px 0 rgba(0,0,0,0.2);
            margin-bottom: 1rem;
        }

        .game-over-stats {
            background: rgba(255,255,255,0.2);
            padding: 2rem 3rem;
            border-radius: 20px;
            margin-bottom: 2rem;
            text-align: center;
        }

        .game-over-bugs {
            font-size: 4rem;
            font-weight: 900;
            color: var(--grandma-yellow);
            text-shadow: 3px 3px 0 rgba(0,0,0,0.2);
        }

        .game-over-label {
            color: white;
            font-size: 1.2rem;
        }

        .game-over-rank {
            color: var(--grandma-yellow);
            font-size: 1.5rem;
            font-weight: 700;
            margin-top: 1rem;
        }

        .bug-list {
            background: white;
            border-radius: 20px;
            padding: 1.5rem;
            max-width: 500px;
            width: 90%;
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 2rem;
        }

        .bug-list h3 {
            color: var(--grandma-brown);
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .bug-list-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0;
            font-size: 0.95rem;
            color: #555;
            border-bottom: 1px solid #eee;
        }

        .bug-list-item:last-child {
            border-bottom: none;
        }

        .bug-list-item.found {
            color: var(--grandma-green);
        }

        .bug-list-item.missed {
            color: #aaa;
        }

        .restart-btn {
            background: var(--grandma-yellow);
            color: var(--grandma-brown);
            border: none;
            padding: 1.2rem 3rem;
            font-size: 1.3rem;
            font-weight: 900;
            border-radius: 50px;
            cursor: pointer;
            font-family: inherit;
            box-shadow: 0 6px 0 #C9A227;
            transition: all 0.2s;
        }

        .restart-btn:hover {
            transform: translateY(-3px);
        }

        /* ===== è¼”åŠ©æ•ˆæœ ===== */
        .cart-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.3);
            z-index: 150;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .cart-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }

        .hint-badge {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--grandma-orange);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            z-index: 50;
            transition: all 0.3s;
        }

        .hint-badge:hover {
            transform: scale(1.05);
        }

        /* Admin panel (hidden) */
        .admin-panel {
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: #1a1a2e;
            color: #00ff00;
            padding: 2rem;
            border-radius: 10px;
            font-family: 'Courier Prime', monospace;
            z-index: 600;
            display: none;
            min-width: 400px;
        }

        .admin-panel.show {
            display: block;
        }

        .admin-panel h2 {
            color: #ff0000;
            margin-bottom: 1rem;
        }

        .admin-panel p {
            margin: 0.5rem 0;
        }
    </style>
</head>
<body>
    <!-- éŠæˆ²é–‹å§‹ç•«é¢ -->
    <div class="game-intro" id="gameIntro">
        <div class="intro-grandma">ğŸ‘µ</div>
        <h1 class="intro-title">é˜¿å¬¤çš„ Bug çµå ´</h1>
        <p class="intro-subtitle">æ­¡è¿ä¾†åˆ°å……æ»¿ Bug çš„èœå¸‚å ´ï¼</p>
        
        <div class="intro-rules">
            <h3>ğŸ“‹ éŠæˆ²è¦å‰‡</h3>
            <ul>
                <li>é€™æ˜¯ä¸€å€‹ã€Œæ•…æ„å¯«å£ã€çš„è³¼ç‰©ç¶²ç«™</li>
                <li>ä½ çš„ä»»å‹™æ˜¯æ‰¾å‡ºæ‰€æœ‰éš±è—çš„ Bug</li>
                <li>è©¦è©¦çœ‹è¼¸å…¥å¥‡æ€ªçš„æ•¸å­—ã€é‡è¤‡ä½¿ç”¨å„ªæƒ åˆ¸...</li>
                <li>æ¯æ‰¾åˆ°ä¸€å€‹ Bugï¼Œé˜¿å¬¤æœƒå‘Šè¨´ä½ å°æ‡‰çš„ç« ç¯€ï¼</li>
                <li>é™æ™‚ 5 åˆ†é˜ï¼Œçœ‹ä½ èƒ½æ‰¾åˆ°å¹¾å€‹ Bugï¼Ÿ</li>
            </ul>
        </div>
        
        <button class="start-btn" onclick="startGame()">
            ğŸ® é–‹å§‹æŒ‘æˆ°ï¼
        </button>
    </div>

    <!-- éŠæˆ² HUD -->
    <div class="game-hud">
        <div class="hud-left">
            <div class="hud-grandma">ğŸ‘µ</div>
            <div class="hud-title">
                é˜¿å¬¤çš„èœå¸‚å ´
                <span>Bug çµå ´æŒ‘æˆ°è³½</span>
            </div>
        </div>
        <div class="hud-stats">
            <div class="stat-box">
                <div class="stat-label">ç™¼ç¾ Bug</div>
                <div class="stat-value" id="bugCount">0</div>
            </div>
            <div class="stat-box" id="timerBox">
                <div class="stat-label">å‰©é¤˜æ™‚é–“</div>
                <div class="stat-value" id="timer">5:00</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">ç¸½ Bug æ•¸</div>
                <div class="stat-value" id="totalBugs">8</div>
            </div>
        </div>
    </div>

    <!-- è³¼ç‰©ç¶²ç«™ä¸»é«” -->
    <div class="shop-container">
        <header class="shop-header">
            <div class="shop-logo">
                <div class="shop-logo-icon">ğŸ¥¬</div>
                <div class="shop-logo-text">
                    <h1>é˜¿å¬¤çš„èœå¸‚å ´</h1>
                    <p>æœ€æ–°é®®çš„åœ¨åœ°å¥½é£Ÿæ</p>
                </div>
            </div>
            <div class="shop-actions">
                <button class="login-btn" onclick="showLogin()">
                    ğŸ‘¤ æœƒå“¡ç™»å…¥
                </button>
                <button class="cart-btn" onclick="toggleCart()">
                    ğŸ›’ è³¼ç‰©è»Š
                    <span class="cart-count" id="cartCount">0</span>
                </button>
            </div>
        </header>

        <div class="promo-banner">
            <div class="promo-text">
                <h2>ğŸ‰ æ–°æœƒå“¡é™å®šï¼</h2>
                <p>è¼¸å…¥å„ªæƒ ç¢¼ç«‹å³äº« 8 æŠ˜å„ªæƒ ï¼ï¼ˆå¯é‡è¤‡ä½¿ç”¨ï¼ŸğŸ¤”ï¼‰</p>
            </div>
            <div class="promo-coupon">
                <span>å„ªæƒ ä»£ç¢¼</span>
                <strong>GRANDMA20</strong>
            </div>
        </div>

        <div class="products-grid" id="productsGrid">
            <!-- å•†å“æœƒç”± JS å‹•æ…‹ç”Ÿæˆ -->
        </div>
    </div>

    <!-- è³¼ç‰©è»Šé®ç½© -->
    <div class="cart-overlay" id="cartOverlay" onclick="toggleCart()"></div>

    <!-- è³¼ç‰©è»Šé¢æ¿ -->
    <div class="cart-panel" id="cartPanel">
        <div class="cart-header">
            <h2>ğŸ›’ è³¼ç‰©è»Š</h2>
            <button class="close-cart" onclick="toggleCart()">âœ•</button>
        </div>
        <div class="cart-items" id="cartItems">
            <div class="cart-empty">
                <span>ğŸ›’</span>
                <p>è³¼ç‰©è»Šæ˜¯ç©ºçš„ï½<br>å¿«å»é¸è³¼æ–°é®®å¥½èœå§ï¼</p>
            </div>
        </div>
        <div class="cart-footer">
            <div class="coupon-input">
                <input type="text" id="couponInput" placeholder="è¼¸å…¥å„ªæƒ ç¢¼">
                <button onclick="applyCoupon()">å¥—ç”¨</button>
            </div>
            <div class="cart-totals">
                <div class="cart-total-row">
                    <span>å°è¨ˆ</span>
                    <span id="subtotal">$0</span>
                </div>
                <div class="cart-total-row discount" id="discountRow" style="display: none;">
                    <span>æŠ˜æ‰£</span>
                    <span id="discount">-$0</span>
                </div>
                <div class="cart-total-row final">
                    <span>ç¸½è¨ˆ</span>
                    <span id="total">$0</span>
                </div>
            </div>
            <button class="checkout-btn" onclick="checkout()">
                ğŸ’³ å‰å¾€çµå¸³
            </button>
        </div>
    </div>

    <!-- ç™»å…¥å½ˆçª— -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal">
            <div class="modal-header">
                <h2>ğŸ‘¤ æœƒå“¡ç™»å…¥</h2>
                <button class="modal-close" onclick="hideLogin()">âœ•</button>
            </div>
            <form onsubmit="return handleLogin(event)">
                <div class="form-group">
                    <label>å¸³è™Ÿ</label>
                    <input type="text" id="loginUser" placeholder="è«‹è¼¸å…¥å¸³è™Ÿ">
                </div>
                <div class="form-group">
                    <label>å¯†ç¢¼</label>
                    <input type="password" id="loginPass" placeholder="è«‹è¼¸å…¥å¯†ç¢¼">
                </div>
                <button type="submit" class="login-submit">ç™»å…¥</button>
            </form>
            <div class="login-hint">
                ğŸ’¡ æç¤ºï¼šé˜¿å¬¤èªªç™»å…¥ç³»çµ±æœ‰é»â‹¯â‹¯ä¸å¤ªå®‰å…¨ï¼Ÿè©¦è©¦çœ‹ç‰¹åˆ¥çš„è¼¸å…¥å§ï¼
            </div>
        </div>
    </div>

    <!-- Bug ç™¼ç¾æç¤º -->
    <div class="bug-toast" id="bugToast">
        <button class="bug-toast-close" onclick="hideBugToast()">âœ•</button>
        <div class="bug-toast-header">
            <span class="bug-toast-icon">ğŸ›</span>
            <span class="bug-toast-title" id="bugTitle">ç™¼ç¾ Bugï¼</span>
            <span class="bug-toast-chapter" id="bugChapter">ç¬¬ X ç« </span>
        </div>
        <p class="bug-toast-message" id="bugMessage">
            é˜¿å¬¤èªªï¼šé€™å°±æ˜¯æ›¸ä¸­æåˆ°çš„ XX å•¦ï¼
        </p>
    </div>

    <!-- çµå¸³çµæœ -->
    <div class="checkout-overlay" id="checkoutOverlay">
        <div class="checkout-result">
            <div class="checkout-icon" id="checkoutIcon">ğŸ§¾</div>
            <h2 class="checkout-title" id="checkoutTitle">äº¤æ˜“å®Œæˆ</h2>
            <div class="checkout-amount" id="checkoutAmount">$0</div>
            <p class="checkout-message" id="checkoutMessage">æ„Ÿè¬æ‚¨çš„è³¼è²·ï¼</p>
            <button class="checkout-close" onclick="closeCheckout()">ç¢ºèª</button>
        </div>
    </div>

    <!-- éŠæˆ²çµæŸç•«é¢ -->
    <div class="game-over" id="gameOver">
        <div class="game-over-icon">ğŸ†</div>
        <h1 class="game-over-title">æŒ‘æˆ°çµæŸï¼</h1>
        <div class="game-over-stats">
            <div class="game-over-bugs" id="finalBugs">0</div>
            <div class="game-over-label">å€‹ Bug</div>
            <div class="game-over-rank" id="rank">æ¸¬è©¦æ–°æ‰‹</div>
        </div>
        <div class="bug-list" id="bugList">
            <h3>ğŸ› Bug æ¸…å–®</h3>
            <!-- å‹•æ…‹ç”Ÿæˆ -->
        </div>
        <button class="restart-btn" onclick="restartGame()">
            ğŸ”„ å†ç©ä¸€æ¬¡
        </button>
    </div>

    <!-- éš±è—çš„ Admin é¢æ¿ -->
    <div class="admin-panel" id="adminPanel">
        <h2>âš ï¸ å¾Œå°ç®¡ç†ç³»çµ±</h2>
        <p>æ­¡è¿ï¼Œç®¡ç†å“¡ï¼</p>
        <p>ä»Šæ—¥è¨‚å–®ï¼š<span style="color: #ffff00">1,234</span> ç­†</p>
        <p>ä»Šæ—¥ç‡Ÿæ”¶ï¼š<span style="color: #ffff00">$567,890</span></p>
        <p>æœƒå“¡ç¸½æ•¸ï¼š<span style="color: #ffff00">9,999</span> äºº</p>
        <p style="margin-top: 1rem; color: #ff6b6b;">
            é€™å°±æ˜¯ SQL Injection çš„å¨åŠ›ï¼<br>
            ä»»ä½•äººéƒ½èƒ½ç”¨ ' OR '1'='1 é€²ä¾†ï¼
        </p>
    </div>

    <!-- æç¤ºå¾½ç«  -->
    <div class="hint-badge" onclick="showHint()">
        ğŸ’¡ æç¤º
    </div>

    <script>
        // ===== éŠæˆ²ç‹€æ…‹ =====
        const gameState = {
            started: false,
            timeLeft: 300, // 5 åˆ†é˜
            bugsFound: new Set(),
            cart: [],
            appliedCoupons: [],
            discountPercent: 0,
            totalBugs: 8
        };

        // ===== Bug å®šç¾© =====
        const bugs = {
            negativeQty: {
                name: 'è² æ•¸è³¼è²·',
                chapter: 'ç¬¬ 5 ç« ',
                message: 'é˜¿å¬¤èªªï¼šã€Œé€™å°±æ˜¯é‚Šç•Œå€¼åˆ†æå•¦ï¼æ€éº¼å¯ä»¥è²· -1 å€‹æ±è¥¿ï¼Ÿä½ æ²’çœ‹æ›¸å–”ï¼Ÿã€',
                hint: 'è©¦è©¦çœ‹è³¼è²·æ•¸é‡è¼¸å…¥è² æ•¸...'
            },
            zeroQty: {
                name: 'é›¶æ•¸é‡çµå¸³',
                chapter: 'ç¬¬ 5 ç« ',
                message: 'é˜¿å¬¤èªªï¼šã€Œé‚Šç•Œå€¼è¦æ¸¬ 0 å•¦ï¼è²· 0 å€‹ä¹Ÿèƒ½çµå¸³æ˜¯æ€æ¨£ï¼Ÿã€',
                hint: 'è³¼ç‰©è»Šè£¡æ”¾ 0 å€‹å•†å“è©¦è©¦çœ‹...'
            },
            hugeQty: {
                name: 'è¶…å¤§æ•¸é‡',
                chapter: 'ç¬¬ 5 ç« ',
                message: 'é˜¿å¬¤èªªï¼šã€Œä¸Šé™æ²’è¨­å¥½å°±æœƒå‡ºäº‹ï¼èª°å®¶èƒ½å­˜ 99999 é¡†é«˜éº—èœï¼Ÿã€',
                hint: 'è©¦è©¦çœ‹è¼¸å…¥ä¸€å€‹è¶…ç´šå¤§çš„æ•¸å­—...'
            },
            doubleCoupon: {
                name: 'å„ªæƒ åˆ¸ç–ŠåŠ ',
                chapter: 'ç¬¬ 6 ç« ',
                message: 'é˜¿å¬¤èªªï¼šã€Œé€™æ˜¯ç‹€æ…‹æ¸¬è©¦çš„ç¶“å…¸éŒ¯èª¤ï¼å„ªæƒ åˆ¸ç”¨ä¸€æ¬¡å°±è©²å¤±æ•ˆï¼Œæ€éº¼å¯ä»¥ä¸€ç›´ç–ŠåŠ ï¼Ÿã€',
                hint: 'åŒä¸€å¼µå„ªæƒ åˆ¸å¯ä»¥ç”¨å¹¾æ¬¡å‘¢ï¼Ÿ'
            },
            sqlInjection: {
                name: 'SQL Injection',
                chapter: 'ç¬¬ 8 ç« ',
                message: 'é˜¿å¬¤èªªï¼šã€Œè³‡å®‰æ¼æ´å•Šï¼å¸³è™Ÿå¯†ç¢¼éƒ½æ²’åšå¥½éæ¿¾ï¼Œé§­å®¢æœ€æ„›é€™ç¨®ç¶²ç«™äº†ï¼ã€',
                hint: 'ç™»å…¥æ™‚è©¦è©¦çœ‹ç‰¹åˆ¥çš„å­—å…ƒ...'
            },
            negativeTotal: {
                name: 'è² æ•¸é‡‘é¡',
                chapter: 'ç¬¬ 5 ç« ',
                message: 'é˜¿å¬¤èªªï¼šã€ŒæŠ˜æ‰£å¾Œé‡‘é¡è®Šè² çš„ï¼Ÿé€™æ¨£åº—éƒ½è¦å€’äº†ï¼é‚Šç•Œå€¼æ²’æ¸¬å¥½å•¦ï¼ã€',
                hint: 'æŠ˜æ‰£æœ‰ä¸Šé™å—ï¼Ÿ'
            },
            floatQty: {
                name: 'å°æ•¸æ•¸é‡',
                chapter: 'ç¬¬ 4 ç« ',
                message: 'é˜¿å¬¤èªªï¼šã€Œç­‰åƒ¹é¡åŠƒåˆ†è¦åšå¥½ï¼0.5 é¡†è˜‹æœæ˜¯ä»€éº¼é¬¼ï¼Ÿã€',
                hint: 'æ•¸é‡ä¸€å®šè¦æ˜¯æ•´æ•¸å—ï¼Ÿ'
            },
            xss: {
                name: 'XSS æ”»æ“Š',
                chapter: 'ç¬¬ 8 ç« ',
                message: 'é˜¿å¬¤èªªï¼šã€Œåˆæ˜¯è³‡å®‰å•é¡Œï¼è¼¸å…¥æ²’éæ¿¾å°±ç›´æ¥é¡¯ç¤ºï¼Œå¤ªå±éšªäº†ï¼ã€',
                hint: 'å„ªæƒ ç¢¼è¼¸å…¥æ¡†æœƒéæ¿¾ç‰¹æ®Šå­—å…ƒå—ï¼Ÿ'
            }
        };

        // ===== å•†å“è³‡æ–™ =====
        const products = [
            { id: 1, name: 'æœ‰æ©Ÿé«˜éº—èœ', emoji: 'ğŸ¥¬', price: 45, unit: 'é¡†', origin: 'é›²æ—' },
            { id: 2, name: 'ç´…è˜¿è””', emoji: 'ğŸ¥•', price: 30, unit: 'æ–¤', origin: 'å½°åŒ–' },
            { id: 3, name: 'æ–°é®®è˜‹æœ', emoji: 'ğŸ', price: 35, unit: 'é¡†', origin: 'æ¢¨å±±', originalPrice: 50 },
            { id: 4, name: 'é¦™ç”œé¦™è•‰', emoji: 'ğŸŒ', price: 25, unit: 'ä¸²', origin: 'å±æ±' },
            { id: 5, name: 'æœ‰æ©Ÿç•ªèŒ„', emoji: 'ğŸ…', price: 60, unit: 'ç›’', origin: 'å˜‰ç¾©' },
            { id: 6, name: 'æ–°é®®é›è›‹', emoji: 'ğŸ¥š', price: 80, unit: 'ç›’', origin: 'å—æŠ•' },
            { id: 7, name: 'æ‰‹å·¥è±†è…', emoji: 'ğŸ§ˆ', price: 40, unit: 'å¡Š', origin: 'å°å—' },
            { id: 8, name: 'é˜¿å¬¤çš„ç§æˆ¿æ»·è‚‰', emoji: 'ğŸ–', price: 120, unit: 'ä»½', origin: 'é˜¿å¬¤å®¶', originalPrice: 150 }
        ];

        // ===== åˆå§‹åŒ– =====
        function init() {
            renderProducts();
        }

        function renderProducts() {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = products.map(p => `
                <div class="product-card">
                    <div class="product-image">${p.emoji}</div>
                    <div class="product-info">
                        <h3 class="product-name">${p.name}</h3>
                        <p class="product-origin">ğŸ“ ${p.origin}</p>
                        <div class="product-price">
                            <span class="price-current">$${p.price}</span>
                            <span class="price-unit">/ ${p.unit}</span>
                            ${p.originalPrice ? `<span class="price-original">$${p.originalPrice}</span>` : ''}
                        </div>
                        <div class="product-qty">
                            <button class="qty-btn" onclick="changeQty(${p.id}, -1)">âˆ’</button>
                            <input type="text" class="qty-input" id="qty-${p.id}" value="1">
                            <button class="qty-btn" onclick="changeQty(${p.id}, 1)">+</button>
                        </div>
                        <button class="add-cart-btn" onclick="addToCart(${p.id})">
                            ğŸ›’ åŠ å…¥è³¼ç‰©è»Š
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ===== éŠæˆ²æ§åˆ¶ =====
        function startGame() {
            gameState.started = true;
            document.getElementById('gameIntro').classList.add('hidden');
            startTimer();
        }

        function startTimer() {
            const timerEl = document.getElementById('timer');
            const timerBox = document.getElementById('timerBox');
            
            const interval = setInterval(() => {
                if (!gameState.started) {
                    clearInterval(interval);
                    return;
                }
                
                gameState.timeLeft--;
                const mins = Math.floor(gameState.timeLeft / 60);
                const secs = gameState.timeLeft % 60;
                timerEl.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
                
                if (gameState.timeLeft <= 30) {
                    timerBox.classList.add('timer-critical');
                }
                
                if (gameState.timeLeft <= 0) {
                    clearInterval(interval);
                    endGame();
                }
            }, 1000);
        }

        function endGame() {
            gameState.started = false;
            document.getElementById('gameOver').classList.add('show');
            document.getElementById('finalBugs').textContent = gameState.bugsFound.size;
            
            // è¨ˆç®—ç­‰ç´š
            const count = gameState.bugsFound.size;
            let rank = '';
            if (count === 0) rank = 'ğŸŒ± æ¸¬è©¦èŒæ–°';
            else if (count <= 2) rank = 'ğŸ£ æ¸¬è©¦æ–°æ‰‹';
            else if (count <= 4) rank = 'ğŸ¦Š æ¸¬è©¦å¥½æ‰‹';
            else if (count <= 6) rank = 'ğŸ¦ æ¸¬è©¦è€é³¥';
            else if (count <= 7) rank = 'ğŸ‰ æ¸¬è©¦å¤§å¸«';
            else rank = 'ğŸ‘µ é˜¿å¬¤èªè­‰ï¼';
            
            document.getElementById('rank').textContent = rank;
            
            // é¡¯ç¤º Bug æ¸…å–®
            const listEl = document.getElementById('bugList');
            listEl.innerHTML = '<h3>ğŸ› Bug æ¸…å–®</h3>' + 
                Object.entries(bugs).map(([key, bug]) => `
                    <div class="bug-list-item ${gameState.bugsFound.has(key) ? 'found' : 'missed'}">
                        ${gameState.bugsFound.has(key) ? 'âœ…' : 'âŒ'}
                        ${bug.name} (${bug.chapter})
                    </div>
                `).join('');
        }

        function restartGame() {
            location.reload();
        }

        // ===== Bug ç™¼ç¾ç³»çµ± =====
        function foundBug(bugKey) {
            if (gameState.bugsFound.has(bugKey)) return;
            
            gameState.bugsFound.add(bugKey);
            document.getElementById('bugCount').textContent = gameState.bugsFound.size;
            
            const bug = bugs[bugKey];
            document.getElementById('bugTitle').textContent = `ç™¼ç¾ Bugï¼š${bug.name}`;
            document.getElementById('bugChapter').textContent = bug.chapter;
            document.getElementById('bugMessage').textContent = bug.message;
            
            document.getElementById('bugToast').classList.add('show');
            
            // 5ç§’å¾Œè‡ªå‹•é—œé–‰
            setTimeout(() => {
                document.getElementById('bugToast').classList.remove('show');
            }, 5000);

            // æª¢æŸ¥æ˜¯å¦å…¨éƒ¨æ‰¾åˆ°
            if (gameState.bugsFound.size >= gameState.totalBugs) {
                setTimeout(() => {
                    endGame();
                }, 2000);
            }
        }

        function hideBugToast() {
            document.getElementById('bugToast').classList.remove('show');
        }

        // ===== è³¼ç‰©è»ŠåŠŸèƒ½ =====
        function changeQty(productId, delta) {
            const input = document.getElementById(`qty-${productId}`);
            let val = parseFloat(input.value) || 0;
            input.value = val + delta;
        }

        function addToCart(productId) {
            const input = document.getElementById(`qty-${productId}`);
            const qty = parseFloat(input.value);
            const product = products.find(p => p.id === productId);
            
            // Bug: è² æ•¸æ•¸é‡
            if (qty < 0) {
                foundBug('negativeQty');
            }
            
            // Bug: å°æ•¸æ•¸é‡
            if (qty !== Math.floor(qty)) {
                foundBug('floatQty');
            }
            
            // Bug: è¶…å¤§æ•¸é‡
            if (qty > 9999) {
                foundBug('hugeQty');
            }
            
            // åŠ å…¥è³¼ç‰©è»Šï¼ˆæ•…æ„ä¸æª¢æŸ¥ï¼‰
            const existing = gameState.cart.find(item => item.id === productId);
            if (existing) {
                existing.qty += qty;
            } else {
                gameState.cart.push({
                    ...product,
                    qty: qty
                });
            }
            
            updateCartUI();
            input.value = 1;
        }

        function updateCartUI() {
            const cartItems = document.getElementById('cartItems');
            const cartCount = document.getElementById('cartCount');
            
            const totalItems = gameState.cart.reduce((sum, item) => sum + item.qty, 0);
            cartCount.textContent = totalItems;
            
            if (gameState.cart.length === 0) {
                cartItems.innerHTML = `
                    <div class="cart-empty">
                        <span>ğŸ›’</span>
                        <p>è³¼ç‰©è»Šæ˜¯ç©ºçš„ï½<br>å¿«å»é¸è³¼æ–°é®®å¥½èœå§ï¼</p>
                    </div>
                `;
            } else {
                cartItems.innerHTML = gameState.cart.map((item, idx) => `
                    <div class="cart-item">
                        <span class="cart-item-emoji">${item.emoji}</span>
                        <div class="cart-item-info">
                            <div class="cart-item-name">${item.name}</div>
                            <div class="cart-item-price">$${item.price} Ã— ${item.qty}</div>
                        </div>
                        <button class="cart-item-remove" onclick="removeFromCart(${idx})">ğŸ—‘ï¸</button>
                    </div>
                `).join('');
            }
            
            updateTotals();
        }

        function removeFromCart(index) {
            gameState.cart.splice(index, 1);
            updateCartUI();
        }

        function updateTotals() {
            const subtotal = gameState.cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
            const discountAmount = Math.round(subtotal * gameState.discountPercent / 100);
            const total = subtotal - discountAmount;
            
            document.getElementById('subtotal').textContent = `$${subtotal}`;
            document.getElementById('discount').textContent = `-$${discountAmount}`;
            document.getElementById('total').textContent = `$${total}`;
            
            const discountRow = document.getElementById('discountRow');
            if (gameState.discountPercent > 0) {
                discountRow.style.display = 'flex';
            } else {
                discountRow.style.display = 'none';
            }
            
            // Bug: è² æ•¸é‡‘é¡
            if (total < 0) {
                foundBug('negativeTotal');
            }
        }

        function toggleCart() {
            document.getElementById('cartPanel').classList.toggle('open');
            document.getElementById('cartOverlay').classList.toggle('show');
        }

        // ===== å„ªæƒ åˆ¸ç³»çµ± =====
        function applyCoupon() {
            const input = document.getElementById('couponInput');
            const code = input.value.trim();
            
            // Bug: XSS
            if (code.includes('<') || code.includes('>')) {
                foundBug('xss');
                alert('é˜¿å¬¤èªªï¼šè¼¸å…¥æ€éº¼æœ‰å¥‡æ€ªçš„ç¬¦è™Ÿï¼Ÿï¼ˆXSS æ¼æ´ç™¼ç¾ï¼ï¼‰');
                return;
            }
            
            if (code.toUpperCase() === 'GRANDMA20') {
                // Bug: å„ªæƒ åˆ¸å¯é‡è¤‡ä½¿ç”¨
                gameState.discountPercent += 20;
                gameState.appliedCoupons.push(code);
                
                if (gameState.appliedCoupons.length > 1) {
                    foundBug('doubleCoupon');
                }
                
                updateTotals();
                alert(`å„ªæƒ ç¢¼å¥—ç”¨æˆåŠŸï¼ç›®å‰æŠ˜æ‰£ï¼š${gameState.discountPercent}%`);
            } else if (code) {
                alert('å„ªæƒ ç¢¼ç„¡æ•ˆï¼');
            }
            
            input.value = '';
        }

        // ===== çµå¸³ç³»çµ± =====
        function checkout() {
            if (gameState.cart.length === 0) {
                alert('è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼');
                return;
            }
            
            const subtotal = gameState.cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
            const discountAmount = Math.round(subtotal * gameState.discountPercent / 100);
            const total = subtotal - discountAmount;
            
            // Bug: é›¶æ•¸é‡çµå¸³
            const hasZero = gameState.cart.some(item => item.qty === 0);
            if (hasZero) {
                foundBug('zeroQty');
            }
            
            // é¡¯ç¤ºçµå¸³çµæœ
            const overlay = document.getElementById('checkoutOverlay');
            const icon = document.getElementById('checkoutIcon');
            const title = document.getElementById('checkoutTitle');
            const amount = document.getElementById('checkoutAmount');
            const message = document.getElementById('checkoutMessage');
            
            if (total < 0) {
                icon.textContent = 'ğŸ’°';
                title.textContent = 'æ­å–œç²å¾—é€€æ¬¾ï¼';
                amount.textContent = `+$${Math.abs(total)}`;
                amount.classList.add('negative');
                message.textContent = 'æ„Ÿè¬æ‚¨ç™¼ç¾é€™å€‹ Bugï¼æŠ˜æ‰£å¤ªå¤šåè€Œè®Šæˆé€€æ¬¾äº†ï½';
            } else {
                icon.textContent = 'ğŸ§¾';
                title.textContent = 'äº¤æ˜“å®Œæˆ';
                amount.textContent = `$${total}`;
                amount.classList.remove('negative');
                message.textContent = `æ„Ÿè¬æ‚¨è³¼è²· ${gameState.cart.length} é …å•†å“ï¼`;
            }
            
            overlay.classList.add('show');
            toggleCart();
        }

        function closeCheckout() {
            document.getElementById('checkoutOverlay').classList.remove('show');
            gameState.cart = [];
            gameState.appliedCoupons = [];
            gameState.discountPercent = 0;
            updateCartUI();
        }

        // ===== ç™»å…¥ç³»çµ± =====
        function showLogin() {
            document.getElementById('loginModal').classList.add('show');
        }

        function hideLogin() {
            document.getElementById('loginModal').classList.remove('show');
        }

        function handleLogin(e) {
            e.preventDefault();
            const user = document.getElementById('loginUser').value;
            const pass = document.getElementById('loginPass').value;
            
            // Bug: SQL Injection
            if (user.includes("'") || user.includes("OR") || user.includes("=") ||
                pass.includes("'") || pass.includes("OR") || pass.includes("=")) {
                foundBug('sqlInjection');
                hideLogin();
                document.getElementById('adminPanel').classList.add('show');
                setTimeout(() => {
                    document.getElementById('adminPanel').classList.remove('show');
                }, 5000);
                return false;
            }
            
            // æ­£å¸¸ç™»å…¥å¤±æ•—
            alert('å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤ï¼');
            return false;
        }

        // ===== æç¤ºç³»çµ± =====
        function showHint() {
            const unFound = Object.entries(bugs)
                .filter(([key]) => !gameState.bugsFound.has(key))
                .map(([, bug]) => bug.hint);
            
            if (unFound.length === 0) {
                alert('ğŸ‰ ä½ å·²ç¶“æ‰¾åˆ°æ‰€æœ‰ Bug äº†ï¼');
            } else {
                const hint = unFound[Math.floor(Math.random() * unFound.length)];
                alert(`ğŸ’¡ æç¤ºï¼š${hint}`);
            }
        }

        // åˆå§‹åŒ–
        init();
    </script>
</body>
</html>
